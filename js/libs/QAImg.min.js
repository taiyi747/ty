tinymce.PluginManager.add("QAImg",function(e,i){function t(e,i,t){clearTimeout(a),jQuery("#notice").remove(),n.append('<div id="notice"><div class="notice-bg"></div><div class="notice-wrap"><div class="notice-inner notice-'+e+'">'+i+"</div></div></div>"),t&&(a=setTimeout(function(){jQuery("#notice").remove()},t))}var n=jQuery(e.getElement()).parent(),a=null,o=document.createElement("input");o.setAttribute("type","file"),o.setAttribute("accept","image/*"),o.onchange=function(){var i=this.files[0];if(i){if(!/\.(gif|jpg|jpeg|png|GIF|JPG|JPEG|PNG)$/.test(i.name))return t(0,"仅支持上传jpg、png、gif格式的图片文件",2e3),!1;if(i.size>2097152)return t(0,"图片大小不能超过2M",1500),!1;!function(){var i=new FormData;i.append("upfile",o.files[0]),i.append("action","forum_img_upload"),jQuery.ajax({type:"POST",url:um.ajax_url,data:i,processData:!1,contentType:!1,dataType:"json",success:function(i,n,o){clearTimeout(a),jQuery("#notice").remove(),"0"==i.result?e.insertContent('<img src="'+i.image.url+'" alt="'+i.image.alt+'">'):t(0,"图片上传出错，请稍后再试！",1200)},error:function(e,i,t){clearTimeout(a),jQuery("#notice").remove(),alert(t)}})}(),t(1,'<img class="notice-loading" src="'+jsui.ajaxloading+'"> 正在上传...',0)}},e.addButton("QAImg",{text:"",icon:"image",tooltip:"上传图片",classes:"qaimg",onclick:function(){/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)||o.click()},onTouchEnd:function(){/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)&&o.click()}})});